{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Dashboard</h1>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card text-bg-light h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small">Net (Income - Spending)</h6>
        <h2 class="{% if net >= 0 %}text-success{% else %}text-danger{% endif %}">
          {{ "%.2f"|format(net) }}
        </h2>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-bg-light h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small">Total Spending</h6>
        <h2 class="text-danger">{{ "%.2f"|format(total_spending) }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-bg-light h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small">Total Income</h6>
        <h2 class="text-success">{{ "%.2f"|format(total_income) }}</h2>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small">Spending by Category</h6>
        <canvas id="categoryChart"
                data-category-json='{{ by_category|tojson }}'></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small">Daily Net Amount</h6>
        <canvas id="dailyNetChart"
                data-daily-json='{{ daily_net|tojson }}'></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Monthly net overview (mini chart) -->
<div class="card mt-4">
  <div class="card-header">
    Monthly Net Overview
  </div>
  <div class="card-body">
    {% if monthly %}
      <p class="mb-2">
        <strong>Latest month:</strong>
        {{ monthly[-1].month }}
        â€” Income: {{ "%.2f"|format(monthly[-1].income) }},
        Spending: {{ "%.2f"|format((monthly[-1].spending | abs)) }},
        Net: {{ "%.2f"|format(monthly[-1].net) }}
      </p>

      <table class="table table-sm mb-0">
        <thead>
          <tr>
            <th>Month</th>
            <th class="text-end">Income</th>
            <th class="text-end">Spending</th>
            <th class="text-end">Net</th>
          </tr>
        </thead>
        <tbody>
          {% for m in monthly %}
            <tr>
              <td>{{ m.month }}</td>
              <td class="text-end">{{ "%.2f"|format(m.income) }}</td>
              <td class="text-end text-danger">{{ "%.2f"|format(m.spending | abs) }}</td>
              <td class="text-end {% if m.net < 0 %}text-danger{% else %}text-success{% endif %}">
                {{ "%.2f"|format(m.net) }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted mb-0">
        No monthly data yet. Import some transactions to see this overview.
      </p>
    {% endif %}
  </div>
</div>

<script>
  const monthlyOverview = {{ monthly|default({"labels": [], "income": [], "spending": [], "net": []})|tojson }};
  const moLabels = monthlyOverview.labels || [];
  const moNet = monthlyOverview.net || [];

  if (moLabels.length) {
    const ctxOverview = document.getElementById('monthlyNetOverviewChart').getContext('2d');
    new Chart(ctxOverview, {
      type: 'line',
      data: {
        labels: moLabels,
        datasets: [
          {
            label: 'Net',
            data: moNet,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }
</script>
\n{% endblock %}
