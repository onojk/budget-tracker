{% extends "base.html" %}
{% block content %}
<div class="container py-4"><h1>Transactions</h1>
<table class="table table-hover"><thead class="table-dark"><tr><th>Date</th><th>Amount</th><th>Merchant</th><th>Category</th><th>Notes</th></tr></thead><tbody>
{% for t in transactions %}
<tr data-id="{{ t.id }}"><td>{{ t.date.strftime("%Y-%m-%d") }}</td><td class="{{ "text-danger" if t.amount < 0 else "text-success" }} fw-bold">${{ "%.2f" % t.amount }}</td><td class="editable" data-field="merchant">{{ t.merchant }}</td><td class="editable" data-field="category">{{ t.category }}</td><td class="editable" data-field="notes">{{ t.notes or "" }}</td></tr>{% endfor %}</tbody></table>
<h3>Add Transaction</h3><form method="POST" action="/add_transaction" class="row g-3 mb-5"><div class="col-md-2"><input type="date" name="date" class="form-control" required></div><div class="col-md-2"><input type="number" step="0.01" name="amount" class="form-control" required></div><div class="col-md-3"><input type="text" name="merchant" class="form-control"></div><div class="col-md-2"><input type="text" name="category" class="form-control"></div><div class="col-md-2"><input type="text" name="notes" class="form-control"></div><div class="col-md-1"><button class="btn btn-success">Add</button></div></form></div>
<script>document.querySelectorAll(".editable").forEach(c=>c.addEventListener("dblclick",function(){if(this.querySelector("input"))return;const f=this.dataset.field,v=this.textContent.trim(),i=document.createElement("input");i.value=v;i.className="form-control form-control-sm";this.textContent="";this.appendChild(i);i.focus();i.addEventListener("blur",()=>{fetch("/update_transaction/"+this.parentNode.dataset.id,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[f]:i.value||null})}).then(()=>location.reload())})}));</script>
{% endblock %}